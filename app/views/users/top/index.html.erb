<h1>図書館へようこそ</h1>

<p><%= link_to "新規図書購入申請", new_users_new_book_path %></p>

<h2>図書一覧</h2>

<%= search_form_for @search, url: users_top_index_path do |f| %>
  <%= f.condition_fields do |c| %>
  <div class="field">
    <%= c.attribute_fields do |a| %>
      <%= a.attribute_select %>
    <% end %>
    <%= c.predicate_select %>
    <%= c.value_fields do |v| %> 
      <%= v.text_field :value %>
    <% end %>
  </div>
  <% end %>
  <div class="actions"><%= f.submit "Search" %></div>
<% end %>

<table rules="all">
    <thead>
      <tr>
        <th>タイトル</th>
        <th>著者</th>
        <th>出版社</th>
      </tr>
    </thead>

    <tbody>
      <% @books.each do |book| %>
      <tr>
        <td><%= link_to book.title, users_book_path(book.id) %> </td>
        <td><%= book.author.author_name %></td>
        <td><%= book.publisher.publisher_name %></td>
      </tr>
    </tbody>
  <% end %>
</table>


<h2>本の貸出し状態</h2>
<table rules="all">
    <thead>
      <tr>
        <th>図書番号</th>
        <th>タイトル</th>
        <th>著者</th>
        <th>状態</th>
        <th>最終更新日</th>
      </tr>
    </thead>
    <tbody>
      <% @reservations.each do |reservation| %>
      <tr>
        <td><%= sprintf("%08d", reservation.stock.id) %></td>
        <td><%= link_to reservation.stock.book.title, users_book_path(reservation.stock.book_id) %></td>
        <td><%= reservation.stock.book.author.author_name %></td>
        <td>
          <% case reservation.reservation_status_id %>
          <% when 1 %>
            予約中
          <% when 2 %>
            貸出し中
          <% when 3 %>
            貸出し期限切れ
          <% when 4 %>
            返却済み
          <% end %>
        </td>
        <td><%= reservation.updated_at %></td>
      </tr>
    </tbody>
  <% end %>
</table>

<h2>ブックマークした本一覧</h2>
<table rules="all">
    <thead>
      <tr>
        <th>タイトル</th>
        <th>著者</th>
        <th>出版社</th>
      </tr>
    </thead>
    <tbody>
      <% @bookmarks.each do |bookmark| %>
      <tr>
        <td><%= link_to bookmark.book.title, users_book_path(bookmark.book_id) %> </td>
        <td><%= bookmark.book.author.author_name %></td>
        <td><%= bookmark.book.publisher.publisher_name %></td>
      </tr>
    </tbody>
  <% end %>
</table>

